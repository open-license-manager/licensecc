language: cpp
services: docker

matrix:
   include:
   - os: linux
     dist: bionic
     addons:
        apt:
          packages:
             - cmake
             - valgrind
             - libssl-dev
             - zlib1g-dev
             - libboost-dev
             - libboost-test-dev
             - libboost-filesystem-dev
             - libboost-iostreams-dev
             - libboost-program-options-dev
             - libboost-system-dev
             - libboost-thread-dev
             - libboost-date-time-dev
   - os: linux
     dist: xenial
     addons:
        apt:
          packages:
             - cmake
             - valgrind
             - libssl-dev
             - zlib1g-dev
             - libboost-dev
             - libboost-test-dev
             - libboost-filesystem-dev
             - libboost-iostreams-dev
             - libboost-program-options-dev
             - libboost-system-dev
             - libboost-thread-dev
             - libboost-date-time-dev
             
   - os: linux
     dist: bionic
     before_script:
        - docker run --name centos7_dev -v $(pwd)/open-license-manager:/root/open-license-manager centos:centos7 /bin/bash -c "yum -y update && yum -y install cmake boost boost-devel boost-static openssl openssl-devel gcc-c++ valgrind valgrind-devel glibc-static && cd /root/open-license-manager && mkdir build && cd build && cmake .."
        - docker commit centos7_dev centos7_configured
        - pwd
     script: pwd

before_script:
    - mkdir build
    - cd build && cmake -DCMAKE_INSTALL_PREFIX=../../install ..

script: 
    - make 
    - make install
    - make test
